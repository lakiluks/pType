<!doctype html>
<html>

    <head>
        <meta charset="utf-8" />

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>
        <script src="jquery.mock.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="chance.js"></script>
        <script src="ptype.js"></script>

        <script src="https://code.highcharts.com/highcharts.js"></script>

        <style>
            .metrics .panel-body {
                padding: 10px;
            }

            .metrics .panel .value {
                margin-top: 5px;
                font-size: 24px;
            }

            .metrics .panel .value i {
                margin: 0 10px 0 0 ;
            }

            .metrics .options {
                cursor: pointer;
            }
        </style>

        <script>
            function decimal2 (num) {
                return num.toString().match(/\./) ? num.toFixed(2) : num;
            }
        </script>
    </head>


    <body>

        <div data-toggle="modal" data-target=".bs-example-modal-lg" style="position: fixed; z-index: 9999; top: 0; right: 0; background: #ccc; box-shadow: 0 0 5px rgba(0,0,0,0.4); border: 1px solid #999; border-top: none; border-right: none; padding: 5px; cursor: pointer;">
            <i style="color: #840000;" class="glyphicon glyphicon-flag"></i> <span>Sporoči napako</span>
        </div>

        <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Sporoči napako razvijalcem </h4>
                    </div>

                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label>Opis napake</label>
                                <textarea class="form-control"></textarea>
                                <p class="help-block">Napako čimbolj podrobno opišite</p>
                            </div>
                            <div class="form-group">
                                <label>Vzrok napake</label>
                                <textarea class="form-control"></textarea>
                                <p class="help-block">Opišite kako je do napake prišlo</p>
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-success">Pošlji</button>
                    </div>
                </div>
            </div>
        </div>


        <div class="container">

            <h1 class="page-header">Diplomska naloga</h1>

            <h3>Predstavitev simulacije XHR poizvedb in generiranja naključnih podatkov</h3>

            <div class="row metrics">
                <div class="col-sm-3">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <i class="glyphicon options glyphicon-triangle-top pull-right"></i>
                            <b>Prikazi</b>
                            <div class="value">
                                <i class="glyphicon glyphicon-eye-open"></i>
                                <span data-pt-randomize="true" data-pt-name="impressions" data-pt-type="integer" data-pt-options="{min: 30000, max: 100000}" data-pt-latency="200"></span>
                            </div>

                            <div class="settings hide">
                                <hr>
                                <div class="form-group">
                                    <label>Tip podatka</label>
                                    <input type="text" class="form-control" name="type" value="integer">
                                </div>
                                <div class="form-group">
                                    <label>Opcije</label>
                                    <input type="text" class="form-control" name="options" value="min: 30000, max: 100000">
                                </div>
                                <button type="button" class="btn btn-default generate">Generiraj</button>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="col-sm-3">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <i class="glyphicon options glyphicon-triangle-top pull-right"></i>
                            <b>Kliki</b>
                            <div class="value">
                                <i class="glyphicon glyphicon-screenshot"></i>
                                <span data-pt-randomize="true" data-pt-name="clicks" data-pt-type="integer" data-pt-options="min: 800, max: 10000"></span>
                            </div>

                            <div class="settings hide">
                                <hr>
                                <div class="form-group">
                                    <label>Tip podatka</label>
                                    <input type="text" class="form-control" name="type" value="integer">
                                </div>
                                <div class="form-group">
                                    <label>Opcije</label>
                                    <input type="text" class="form-control" name="options" value="min: 800, max: 10000">
                                </div>
                                <button type="button" class="btn btn-default generate">Generiraj</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <i class="glyphicon options glyphicon-triangle-top pull-right"></i>
                            <b>Denar</b>
                            <div class="value">
                                <i class="glyphicon glyphicon-eur"></i>
                                <span data-pt-randomize="true" data-pt-name="spent" data-pt-type="floating" data-pt-options="{min: 500, max: 10000, fixed: 2}"></span>
                            </div>

                            <div class="settings hide">
                                <hr>
                                <div class="form-group">
                                    <label>Tip podatka</label>
                                    <input type="text" class="form-control" name="type" value="floating">
                                </div>
                                <div class="form-group">
                                    <label>Opcije</label>
                                    <input type="text" class="form-control" name="options" value="min: 500, max: 10000, fixed: 2">
                                </div>
                                <button type="button" class="btn btn-default generate">Generiraj</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-3">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <i class="glyphicon options glyphicon-triangle-top pull-right"></i>
                            <b>RPK</b>
                            <div class="value">
                                <i class="glyphicon glyphicon-record"></i>
                                <span data-pt-name="ctr" data-pt-type="calculated" data-pt-options="clicks/impressions*100" data-pt-formater="decimal2"></span>%
                            </div>

                            <div class="settings hide">
                                <hr>
                                <div class="form-group">
                                    <label>Tip podatka</label>
                                    <input type="text" class="form-control" name="type" value="calculated">
                                </div>
                                <div class="form-group">
                                    <label>Opcije</label>
                                    <input type="text" class="form-control" name="options" value="clicks/impressions*100">
                                </div>
                                <button type="button" class="btn btn-default generate">Generiraj</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                $('.metrics .panel .options').click(function () {
                    $(this)
                            .toggleClass('glyphicon-triangle-top')
                            .toggleClass('glyphicon-triangle-bottom');

                    $(this).parent().find('.settings').toggleClass('hide');
                });

                $('.metrics .panel .generate').click(function () {
                    var parent = $(this).parents('.panel'),
                            el = null;

                    if(parent.find('[data-pt-randomize]').length) {
                        el = parent.find('[data-pt-randomize]');
                        el
                                .attr('data-pt-type', parent.find('[name="type"]').val())
                                .attr('data-pt-options', parent.find('[name="options"]').val());

                        pType.randomize(el);
                    } else if(parent.find('[data-pt-type="calculated"]').length) {
                        el = parent.find('[data-pt-type="calculated"]');
                        el.attr('data-pt-options', parent.find('[name="options"]').val());

                        pType.calculate(el);
                    }
                });
            </script>

            <div class="row">
                <div class="col-sm-12">
                    <div id="hcdiv"></div>
                </div>
            </div>

            <script>
                $(function () {
                    $('#hcdiv').highcharts({
                        chart: {
                            type: 'line',
                            height: 300,
                        },
                        credits: {
                            enabled: false
                        },
                        xAxis: {
                            categories: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11']
                        },
                        yAxis: [{
                            labels: {
                                style: {
                                    color: Highcharts.getOptions().colors[0]
                                }
                            },
                            title: {
                                text: 'Prikazi',
                                style: {
                                    color: Highcharts.getOptions().colors[0]
                                }
                            }
                        },{
                            labels: {
                                style: {
                                    color: Highcharts.getOptions().colors[1]
                                }
                            },
                            title: {
                                text: 'Kliki',
                                style: {
                                    color: Highcharts.getOptions().colors[1]
                                }
                            },
                            opposite: true
                        }],
                        title: false,
                        plotOptions: {
                            line: {
                                dataLabels: {
                                    enabled: true
                                },
                                enableMouseTracking: false
                            }
                        },
                        series: [{
                            name: 'Prikazi',
                            data: [8253, 8322, 8502, 8412, 7758, 7985, 8158, 8568, 8679, 8612, 8302],
                            yAxis: 0
                        }, {
                            name: 'Kliki',
                            data: [689, 692, 706, 661, 512, 568, 578, 603, 621, 689, 721],
                            yAxis: 1
                        }]
                    });
                });
            </script>

            <style>
                .nav-tabs>li.active>a, .nav-tabs>li.active>a:focus, .nav-tabs>li.active>a:hover, .tab-header {
                    background: #Fafafa;
                }

                .tab-header {
                    padding: 5px;
                    border-bottom: 1px solid #ccc;
                }
            </style>

            <div class="row">
                <div class="col-md-12">

                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#random" aria-controls="random" role="tab" data-toggle="tab">Generiranje naključnih podatkov</a></li>
                        <li role="presentation"><a href="#backend" aria-controls="backend" role="tab" data-toggle="tab">Simulacija poizvedbe</a></li>
                        <li role="presentation"><a href="#prepared" aria-controls="backend" role="tab" data-toggle="tab">Pripravljeni podatki</a></li>
                    </ul>


                    <div class="tab-content">

                        <div role="tabpanel" class="tab-pane active" id="random" style="border: 1px solid #ccc; border-top: none;">

                            <div class="tab-header">
                                Tabela naj ima <input type="text" id="tableRows" style="width: 60px;" value="50" /> vrstic in latenco <input type="text"  style="width: 60px;" id="tabeLatency" value="0" /> milisekund <button class="btn btn-default btn-xs" id="tableRefresh">generiraj</button>
                            </div>

                            <table id="students" class="table" data-pt-randomize="50" data-pt-latency="200">
                                <thead>
                                <tr>
                                    <th data-pt-type="first">Ime</th>
                                    <th data-pt-type="last">Priimek</th>
                                    <th data-pt-choices="dodiplomski,podiplomski,pavzer">Status</th>
                                    <th data-pt-choices="informatika,računalniški sistemi,programska oprema">Smer</th>
                                    <th data-pt-type="integer" data-pt-choices="18,19,20,21,22,23,24,25,26,27,28,29">Starost</th>
                                </tr>
                                </thead>

                                <tbody>

                                </tbody>
                            </table>
                        </div>

                        <div role="tabpanel" class="tab-pane" id="backend">

                            <br>
                            <button class="btn btn-default" id="backendRefresh">Ponovi poizvedbo</button>
                            <br>

                            <table id="users" class="table">
                                <thead>
                                    <tr>
                                        <th data-pt-name="id">ID</th>
                                        <th data-pt-name="email">Email</th>
                                        <th data-pt-name="first_name">Ime</th>
                                        <th data-pt-name="last_name">Priimek</th>
                                    </tr>
                                </thead>

                                <tbody>

                                </tbody>
                            </table>


                            <form id="user_form">
                                <span data-pt-name="id"></span>

                                <div class="form-group">
                                    <label>Ime</label>
                                    <input type="text" class="form-control" data-pt-name="first_name" placeholder="Ime">
                                </div>

                                <div class="form-group">
                                    <label>Priimek</label>
                                    <input type="text" class="form-control" data-pt-name="last_name" placeholder="Priimek">
                                </div>

                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="text" class="form-control" data-pt-name="email" placeholder="Email">
                                </div>

                                <div class="form-group">
                                    <label>Tip</label>
                                    <label class="radio-inline">
                                        <input type="radio" name="inlineRadioOptions" data-pt-name="type" value="0"> 1
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="inlineRadioOptions" data-pt-name="type" value="1"> 2
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="inlineRadioOptions" data-pt-name="type" value="2"> 3
                                    </label>
                                </div>

                                <button type="submit" class="btn btn-default">Submit</button>
                            </form>

                            <script>
                                // define ajax mock
                               $.mockjax({
                                    url: "get/data",
                                    responseTime: 2000,
                                    response: function () {
                                        this.responseText = [{
                                            "id": 1,
                                            "first_name": "Luka",
                                            "last_name": "Andrejak",
                                            "email": "luka.andrejak@gmail.com",
                                            "type": 1
                                        }, {
                                            "id": 2,
                                            "first_name": "Janez",
                                            "last_name": "Novak",
                                            "email": "j.novak@gmail.com",
                                            "type": 0
                                        }, {
                                            "id": 3,
                                            "first_name": "Marjan",
                                            "last_name": "Gorišek",
                                            "email": "marjang33@gmail.com",
                                            "type": 1
                                        }, {
                                            "id": 4,
                                            "first_name": "Drago",
                                            "last_name": "Gruden",
                                            "email": "grudendrago@yahoo.com",
                                            "type": 2
                                        }]
                                    }
                                });

                                function loadStudents () {
                                    $.ajax({
                                        url: "get/data",
                                        success: function (data) {
                                            pType.loadData($('#users'), data);
                                            pType.loadData($('#user_form'), data[1]);
                                        }
                                    });
                                }

                                $("#backendRefresh").click(function () {
                                    $('#users tbody').html("");
                                    pType.loadData($('#user_form'), {
                                        "id": '',
                                        "first_name": "",
                                        "last_name": "",
                                        "email": "",
                                        "type": ''
                                    });

                                    loadStudents();
                                });

                                $("#tableRefresh").click(function () {
                                    $('#students tbody').html("");
                                    $('#students')
                                            .attr('data-pt-randomize', $('#tableRows').val())
                                            .attr('data-pt-latency', $('#tabeLatency').val());
                                    pType.randomize($('#students'));
                                });
                            </script>
                        </div>

                        <div role="tabpanel" class="tab-pane" id="prepared">

                            <br>
                            <button class="btn btn-default" id="praparedRefresh">Ponovi poizvedbo</button>
                            <br>

                            <table id="employees" class="table">
                                <tr>
                                    <th data-pt-name="id">ID</th>
                                    <th data-pt-name="gender">Spol</th>
                                    <th data-pt-name="email">Email</th>
                                    <th data-pt-name="first_name">Ime</th>
                                    <th data-pt-name="last_name">Priimek</th>
                                    <th data-pt-name="ip_address">IP</th>
                                </tr>

                            </table>

                            <script>
                                $.mockjax({
                                    url: "get/employees",
                                    responseTime: [100, 1400],
                                    proxy: 'test.json'
                                });

                                function loadEmployees () {
                                    $.getJSON(
                                            "get/employees",
                                            function (data) {
                                                console.log(data);
                                                pType.loadData($('#employees'), data);
                                            }
                                    );
                                }

                                loadEmployees();

                                $("#praparedRefresh").click(function () {
                                    $('#employees tr:gt(0)').remove();
                                    loadEmployees();
                                });

                            </script>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </body>
</html>
